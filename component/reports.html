<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upload Medical Reports</title>
  <link rel="icon" href="../image/favlogo.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{ --bg:#071026; --card:#0b1220; --muted:#94a3b8; --accent:#06b6d4; --danger:#fb7185; }
    body{ background: linear-gradient(180deg,var(--bg), #031027); color: #e6eef6; -webkit-font-smoothing:antialiased; font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    header { border-bottom: 1px solid rgba(255,255,255,0.03); }
    section { background: rgba(255,255,255,0.02); box-shadow: 0 8px 30px rgba(2,6,23,0.7); }
    #drop-zone { background: linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006)); border-radius: 12px; transition: all .18s ease; }
    #drop-zone:hover { transform: translateY(-2px); border-color: rgba(6,182,212,0.42); box-shadow: 0 8px 24px rgba(6,182,212,0.04); }
    #drop-zone:focus { outline: 2px solid rgba(6,182,212,0.08); }
    label[for="file-input"], button#upload-btn, button#clear-btn { padding: .6rem .9rem; font-weight: 600; border-radius: 8px; }
    label[for="file-input"]{ background: transparent; border: 1px solid rgba(255,255,255,0.04); color: #e6eef6; }
    label[for="file-input"]:focus { outline: 3px solid rgba(6,182,212,0.08); outline-offset: 2px; }
    button#upload-btn{ background: linear-gradient(90deg,#0891b2,#06b6d4); color: #042427; border: none; }
    button#upload-btn:disabled{ opacity: 0.55; cursor: not-allowed; filter: grayscale(.15); }
    button#upload-btn:focus, button#clear-btn:focus { outline: 3px solid rgba(6,182,212,0.08); outline-offset: 2px; }
    button#clear-btn{ background: transparent; border: 1px solid rgba(255,255,255,0.04); color: var(--muted); }
    #file-list li{ display: flex; flex-direction: column; gap: .5rem; padding: 12px; background: rgba(255,255,255,0.012); border-radius: 10px; border: 1px solid rgba(255,255,255,0.03); }
    @media(min-width:640px){ #file-list li{ flex-direction: row; align-items: center; justify-content: space-between; } }
    .progress::-webkit-progress-bar{ background: rgba(255,255,255,0.03); border-radius: 8px; }
    .progress::-webkit-progress-value{ background: linear-gradient(90deg,#06b6d4,#0891b2); border-radius: 8px; }
    .progress::-moz-progress-bar{ background: linear-gradient(90deg,#06b6d4,#0891b2); border-radius: 8px; }
    .progress{ height: 10px; width: 100%; appearance: none; }
    .remove-btn{ color: var(--danger); background: transparent; border: none; font-weight: 700; }
    .truncate{ overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .status{ color: var(--muted); }
  </style>
</head>
<body class="bg-slate-900 text-gray-100 min-h-screen flex flex-col">

  <header class="bg-slate-900">
    <div class="max-w-md mx-auto px-4 py-4">
      <h1 class="text-lg text-center text-gray-100">Medical Reports</h1>
    </div>
  </header>

  <main class="flex-1 max-w-md mx-auto px-4 py-6 w-full">
    <section class="bg-slate-800 rounded-lg shadow p-4 border border-slate-700">
      <div id="drop-zone" class="border-2 border-dashed border-slate-700 rounded-lg p-6 text-center cursor-pointer transition-colors hover:border-sky-500" tabindex="0">
  <svg class="mx-auto h-12 w-12 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16v-4a4 4 0 014-4h2a4 4 0 014 4v4M7 16h10M7 16l-1 4h12l-1-4" />
        </svg>
  <p class="mt-3 text-slate-200 text-sm">Drop PDF files here.</p>
        <p class="mt-2 text-xs text-slate-400">Max 10 MB per file. PDFs only.</p>
        <input id="file-input" type="file" accept="application/pdf" multiple class="hidden" />
      </div>

      <div id="files-area" class="mt-4">
        <h2 class="text-sm font-medium text-slate-200">Selected files</h2>
        <ul id="file-list" class="mt-3 space-y-3"></ul>
      </div>

      <div class="mt-4 flex flex-col sm:flex-row items-stretch sm:items-center gap-2">
  <label id="add-btn" for="file-input" class="w-full sm:w-auto px-4 py-2 inline-block text-center bg-transparent border border-slate-600 text-slate-200 rounded cursor-pointer">Add files</label>
        <button id="upload-btn" class="w-full sm:w-auto px-4 py-2 bg-transparent border border-sky-500 text-sky-400 rounded disabled:opacity-60" disabled>Upload</button>
        <button id="clear-btn" class="w-full sm:w-auto px-4 py-2 bg-transparent border border-slate-600 text-slate-200 rounded">Clear</button>
        <div id="status" class="text-sm text-slate-300 ml-0 sm:ml-4"></div>
      </div>

      <div class="mt-4 text-xs text-slate-400">Note: This client-side page posts files to <code>/upload</code>. If you need a server example, I can add one.</div>
    </section>
  </main>

  <footer class="bg-slate-900 border-t border-slate-800 mt-8">
    <div class="max-w-4xl mx-auto px-4 py-4 text-xs text-slate-500">&copy; 2025 HealthyBe â€” Your secure medical reports</div>
  </footer>

  <script>
    // Configuration
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10 MB
    const ALLOWED_TYPE = 'application/pdf';
    const UPLOAD_URL = '/upload'; // server endpoint (change if needed)

    // Elements
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const uploadBtn = document.getElementById('upload-btn');
    const clearBtn = document.getElementById('clear-btn');
    const status = document.getElementById('status');

    let files = [];

    // Helpers
    function humanFileSize(size) {
      if (size === 0) return '0 B';
      const i = Math.floor(Math.log(size) / Math.log(1024));
      return (size / Math.pow(1024, i)).toFixed(1) + ' ' + ['B', 'KB', 'MB', 'GB'][i];
    }

    function renderFileList() {
      fileList.innerHTML = '';
      files.forEach((file, idx) => {
        const li = document.createElement('li');
        // stack vertically on small screens, align horizontally on larger
        li.className = 'flex flex-col sm:flex-row sm:items-center sm:justify-between bg-slate-700 p-3 rounded border border-slate-600';

        const left = document.createElement('div');
        left.className = 'flex-1 min-w-0';

        const name = document.createElement('div');
        // truncate long filenames on small screens
        name.innerHTML = `<div class="font-medium text-sm text-slate-100 truncate">${file.name}</div><div class="text-xs text-slate-300">${humanFileSize(file.size)}</div>`;

        left.appendChild(name);

        const right = document.createElement('div');
        right.className = 'flex items-center gap-3 mt-3 sm:mt-0 sm:ml-4';

        const progressWrapper = document.createElement('div');
        progressWrapper.className = 'flex-1 min-w-0';
  const progress = document.createElement('progress');
        progress.max = 100;
        progress.value = file._progress || 0;
  progress.className = 'progress';
        progressWrapper.appendChild(progress);

  const removeBtn = document.createElement('button');
  removeBtn.className = 'remove-btn';
  removeBtn.textContent = 'Remove';
        removeBtn.addEventListener('click', () => {
          files.splice(idx, 1);
          updateUI();
        });

        right.appendChild(progressWrapper);
        right.appendChild(removeBtn);

        li.appendChild(left);
        li.appendChild(right);

        fileList.appendChild(li);
      });

      uploadBtn.disabled = files.length === 0;
      status.textContent = files.length ? `${files.length} file(s) ready` : '';
    }

    function updateUI() {
      // ensure File objects keep their Blob behavior; only set _progress when missing
      for (let i = 0; i < files.length; i++) {
        if (files[i]._progress === undefined) files[i]._progress = 0;
      }
      renderFileList();
    }

    // File handling
    function handleFiles(selected) {
      const newFiles = Array.from(selected);
      const errors = [];
      newFiles.forEach(f => {
        if (f.type !== ALLOWED_TYPE) {
          errors.push(`${f.name} - invalid file type`);
          return;
        }
        if (f.size > MAX_FILE_SIZE) {
          errors.push(`${f.name} - file too large (${humanFileSize(f.size)})`);
          return;
        }
        // keep a File object but add internal progress
        files.push(Object.assign(f, { _progress: 0 }));
      });

      if (errors.length) {
        alert('Some files were rejected:\n' + errors.join('\n'));
      }
      updateUI();
    }

    // Drag and drop
    ['dragenter', 'dragover'].forEach(evt => {
      dropZone.addEventListener(evt, e => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'copy';
        dropZone.classList.add('border-sky-400', 'bg-slate-800');
      });
    });
    ['dragleave', 'dragend', 'drop'].forEach(evt => {
      dropZone.addEventListener(evt, e => {
        e.preventDefault();
        dropZone.classList.remove('border-sky-400', 'bg-slate-800');
      });
    });

    dropZone.addEventListener('drop', e => {
      const dtFiles = e.dataTransfer.files;
      if (dtFiles && dtFiles.length) handleFiles(dtFiles);
    });

    // open file dialog
    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => {
      handleFiles(e.target.files);
      fileInput.value = '';
    });

    // Upload logic
    function uploadFile(file, onProgress) {
      return new Promise((resolve, reject) => {
        const xhr = new XMLHttpRequest();
        const form = new FormData();
        form.append('file', file, file.name);

        xhr.open('POST', UPLOAD_URL, true);

        xhr.upload.addEventListener('progress', e => {
          const percent = e.lengthComputable ? Math.round((e.loaded / e.total) * 100) : 0;
          onProgress(percent);
        });

        xhr.onreadystatechange = () => {
          if (xhr.readyState === 4) {
            if (xhr.status >= 200 && xhr.status < 300) {
              try {
                const res = JSON.parse(xhr.responseText || '{}');
                resolve(res);
              } catch (err) {
                resolve({ ok: true });
              }
            } else {
              reject(new Error('Upload failed with status ' + xhr.status));
            }
          }
        };

        xhr.onerror = () => reject(new Error('Network error'));

        xhr.send(form);
      });
    }

    async function uploadAll() {
      uploadBtn.disabled = true;
      clearBtn.disabled = true;
      status.textContent = 'Uploading...';

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        try {
          await uploadFile(file, pct => {
            files[i]._progress = pct;
            updateUI();
          });
          files[i]._progress = 100;
          updateUI();
        } catch (err) {
          files[i]._progress = 0;
          updateUI();
          status.textContent = `Upload failed for ${file.name}: ${err.message}`;
          uploadBtn.disabled = false;
          clearBtn.disabled = false;
          return;
        }
      }

      status.textContent = 'All files uploaded successfully.';
      uploadBtn.disabled = false;
      clearBtn.disabled = false;
    }

    uploadBtn.addEventListener('click', () => {
      if (!files.length) return;
      uploadAll();
    });

    clearBtn.addEventListener('click', () => {
      files = [];
      updateUI();
    });

    // keyboard accessibility: Enter to open file dialog
    dropZone.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        fileInput.click();
      }
    });

    // initial render
    updateUI();
  </script>
</body>
</html>